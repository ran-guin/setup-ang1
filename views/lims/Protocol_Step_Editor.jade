extends ./../customize/privateLayout

block content

  div.container
    include ./../core/errorMsg.jade
    
    // input variables: 
    //    - plate_ids  (array); 
    //    - Samples    (array of hashes)
    //    - Steps      (array of hashes)
    //    - attributes (array of hashes)

    - var configParams = { record: record, payload: session.payload };

    - var init = "initialize(" + JSON.stringify(configParams) + ")";

    //- flds = fields || []; 
    //- units = { 'solution_qty' : 'solution_qty_units', 'transfer_qty' : 'transfer_qty_units'};
    - aliases = { 'equipment' : 'Equip', 'solution' : 'Sol' }
    - var input_options2 = ['transfer_qty', 'split', 'solution_qty', 'solution', 'equipment'];

    - var Options = {};
    - Options['transfer_qty'] = 'Indicate amount of sample to be aliquoted / transferred per well';
    - Options['split']        = 'Number of target wells per source well during transfer';
    - Options['solution_qty'] = 'Track quantity of reagent applied during this step (affects final sample volume if baseline units are the same)';
    - Options['solution']     = 'Track id of reagent applied during this step';
    - Options['equipment']    = 'Track id of equipment used during this step';
  
    - var prompt = { desc : "Select to prompt user to complete this step while using user interface (required to track step)" };
    - var transfer = { desc : "Is sample being relocated within this step to a new target container or box location" };
    - var move = { desc : 'Relocate samples to a new box' }
    - var aliquot = { desc : 'Transfer portion of sample to a target well (leaving some sample remaining)' }
    - var transfer = { desc : 'Transfer all (or specified volume) of original sample to the target well(s), and throw out original sample container(s)' }
    - var preprint = { desc : 'Generate empty target container ids in preparation for future transfer/aliquot.  <B>This should always be followed at some point in the same protocol by an Aliquot or Transfer step</B>' }

    - attributes = attributes || {}; // {'Thaw_Time' : 'integer' }

    div(ng-app='myApp')
      div(ng-controller="SharedController")
       div(ng-controller="FancyFormController")
        div(ng-controller="Protocol_StepController" ng-init="#{init}")
          h3 Protocol Editor 

          form.form-horizontal(role='form' width='100%')
            div.form-group
              label.control-label.col-sm-2(for='name') Name
              div.col-sm-10  
                input.input-lg.form-control#name(type='text' placeholder='Name' ng-model='Record.name')
              
            div.form-group
              label.control-label.col-sm-2(for='instructions') Instructions
              div.col-sm-10  
                input.input-lg.form-control#instructions(type='text' placeholder='Instructions' ng-model='Record.instructions')

            div.form-group
              label.control-label.col-sm-2(for='step_message') Message
              div.col-sm-10  
                input.input-lg.form-control#step_message(placeholder='Message' ng-model='Record.message')
            
            div.form-group
              label.control-label.col-sm-2.input-lg(for='transfer') Transfer / Relocate &nbsp;
                a(href='#' onclick="return false;" tooltip='instructions' data-toggle="popover" data-placement="left" data-trigger="focus" title="Description" data-content="#{transfer.desc}")
                     i.fa.fa-question-circle
              div.col-sm-10
                input.input-lg#transfer(type='checkbox' ng-model='transfer_step')    

            div.form-group
              label.control-label.col-sm-2.input-lg(for='prompt') Prompt &nbsp;
                a(href='#' onclick="return false;" tooltip='instructions' data-toggle="popover" data-placement="left" data-trigger="focus" title="Description" data-content="#{prompt.desc}")
                     i.fa.fa-question-circle
              div.col-sm-10
                input.input-lg#prompt(type='checkbox' ng-model='Record.prompt')
                  

            div.form-group
              label.control-label.col-sm-2.input-lg(for='repeatable') Repeatable &nbsp;
              div.col-sm-10
                div.checkbox
                  label
                    input.input-lg#repeatable(type='checkbox' ng-model='Record.repeatable')
                    b &nbsp; Repeatable                   

            div(ng-show="transfer_step")
              hr
              h3 Transfer / Relocate Options
              div.form-group
                label.input-lg.col-sm-2
                  b Type:
                div.col-sm-2
                  input.input-lg#move(type='radio' name='transfer_type' ng-model='transfer_type' value='Move')
                  label.input-lg(for='move')
                    span &nbsp; Move &nbsp;                    
                      a(href='#' onclick="return false;" tooltip='instructions' data-toggle="popover" data-placement="right" data-trigger="focus" title="Description" data-content="#{move.desc}")
                        i.fa.fa-question-circle
                div.col-sm-2
                    input.input-lg#aliquot(type='radio' name='transfer_type' ng-model='transfer_type' value='Aliquot')
                    label.input-lg(for='aliquot')
                      &nbsp; Aliquot &nbsp;
                      a(href='#' onclick="return false;" tooltip='instructions' data-toggle="popover" data-placement="left" data-trigger="focus" title="Description" data-content="#{aliquot.desc}")
                        i.fa.fa-question-circle
                div.col-sm-2
                  input.input-lg(type='radio' name='transfer_type' ng-model='transfer_type' value='Transfer')
                  label.input-lg(for='transfer')
                    span &nbsp; Transfer &nbsp;
                    a(href='#' onclick="return false;" tooltip='instructions' data-toggle="popover" data-placement="left" data-trigger="focus" title="Description" data-content="#{transfer.desc}")
                      i.fa.fa-question-circle
                div.col-sm-2
                  input.input-lg(type='radio' name='transfer_type' ng-model='transfer_type' value='Pre-print')
                  label.input-lg(for='preprint')
                    span &nbsp; Pre-Print &nbsp;
                    a(href='#' onclick="return false;" tooltip='instructions' data-toggle="popover" data-placement="left" data-trigger="focus" title="Description" data-content="#{preprint.desc}")
                        i.fa.fa-question-circle

              div.form-group
                label.input-lg.col-sm-2
                  b Target Format:
                div.col-sm-10
                  div.checkbox
                    label
                      input.input-lg.mandatory(type='text' placeholder='Target Container Type' ng-required="transfer_step" ng-model='target_container')
  
              div.form-group
                label.input-lg.col-sm-2
                  b Target Sample:
                div.col-sm-10
                  div.checkbox
                    label
                      input.input-lg(type='text' placeholder='Change Sample Type' ng-model='target_sample')

              - var xfer_options = ['transfer_qty', 'split']
              each xfer_option in xfer_options
                div.form-group
                  label.input-lg.col-sm-2
                      b &nbsp; #{xfer_option}
                  div.col-sm-2
                    input.input-lg(type='checkbox' ng-model='input.#{xfer_option}')
                        
                  div.col-sm-3(ng-show="input.#{xfer_option}")
                    input.input-lg(type='text' ng-model='default.#{xfer_option}')
                  div.col-sm-3(ng-show="input.#{xfer_option}")
                    input.input-lg(type='text' ng-model='format.#{xfer_option}')
                  div.col-sm-2(ng-show="input.#{xfer_option}")
                      input.col-sm-2(id='#{xfer_option}_mandatory' type='checkbox' ng-model='mandatory.#{xfer_option}')
                      label.col-sm-10(for='#{xfer_option}_mandatory')
                        b &nbsp; Mandatory
              
              div.form-group
                label.input-lg.col-sm-2
                  b &nbsp; Reset_Focus &nbsp;
                div.col-sm-2
                  input.input-lg(type='checkbox' ng-model='reset_focus')

              hr   

            h3 Custom Formatted Fields (not editable)
            div.form-group
              label.control-label.col-sm-2(for='input_options') Input
              div.col-sm-10  
                input.input-lg.form-control#input_options(placeholder='Input' ng-model='Record.input_options' disabled)

            div.form-group
              label.control-label.col-sm-2(for='input_format') Format              
              div.col-sm-10  
                input.input-lg.form-control#input_format(placeholder='Format' ng-model='Record.input_format' disabled)

            div.form-group                  
              label.control-label.col-sm-2(for='input_defaults') Defaults
              div.col-sm-10  
                input.input-lg.form-control#input_defaults(placeholder='Defaults' ng-model='Record.input_defaults' disabled)

            div.form-group
              label.control-label.col-sm-2(for='custom_settings') Custom_Settings
              div.col-sm-10  
                input.input-lg.form-control#custom_settings(placeholder="Custom" ng-model='Record.custom_settings' disabled)

            hr

          if debug || 1
            div.alert-warning
              hr
              h3 Direct
              b #{ JSON.stringify(record) }



              h3 Angular
              b Record: {{ JSON.stringify(record) }}
              b sails.config.payload: #{ JSON.stringify(sails.config.payload) }
              b session.payload #{ JSON.stringify(session.payload) }