extends privateLayout
block content
  div.container
    h3 File Upload

    - var config = { data: data };
    - var init = "initialize(" + JSON.stringify(config) + ")";

    div(ng-app='myApp')
      div(ng-controller="SharedController", ng-init="#{init}")
        div(ng-controller="UploadController", ng-init="#{init}")

          br 
          include ./../core/errorAngularMsg.jade
          br 

          form(role='form' method='post' action="/uploadData" enctype='form-data')
            table.table
              tr(ng-show="! validated")
                td
                  b Page: &nbsp;
                td
                  input(type='number' name='page' ng-model='page' ng-change="initiate_page()")
                td
                  b Start on row: 
                td
                  input(type='number' ng-model='starting_row' default=1 ng-change="get_block()" size=5) 
                td
                  b Start on column: 
                td  
                  input(type='number' ng-model='starting_column' ng-change="get_block()") 
              tr(ng-show="! validated")              
                td
                  b Rows: 
                td
                  input(type='number' ng-model='rows' default=1 ng-change="get_block()") 
                td
                  b Columns: 
                td  
                  input(type='number' ng-model='columns' ng-change="get_block()")               
                td
                  span &nbsp;

              tr(ng-show='1 || validated')
                td(colspan=2)
                  button.btn.btn-lg.btn-success(type='button', ng-click='validate_data()' ng-show="!validated") Validate
                  span &nbsp;
                  button.form-control.btn.btn.lg.btn-warning(type='button', ng-click='modify()' ng-show="validated") Modify
                td(colspan=2)
                  button.btn.btn.lg.btn-success(type='button' ng-click="upload()" ng-show="validated") Upload Data
                td(colspan=2)
                  a(href='#' onclick="return false;" tooltip='instructions' data-toggle="tooltip" title="<div style='text-align:left'>* <b>Skip</b> records that exist<br><span style='text-align:left'>* <b>Overwrite</b> conflicts<br><span style='text-align:left'>* <B>Abort</B> if conlicts found" data-html='true')
                    i.fa.fa-question-circle
                  span &nbsp; 
                  b If data already defined: &nbsp;
                  input(nome='onduplicate' type='radio' ng-model='onDuplicate' value='ignore')
                  span &nbsp;Skip &nbsp;
                  input(nome='onduplicate' type='radio' ng-model='onDuplicate' value='replace')
                  span &nbsp;Overwrite &nbsp;
                  input(nome='onduplicate' type='radio' ng-model='onDuplicate' value='')
                  span &nbsp;Abort &nbsp; &nbsp;

                  //- a(href='#' onclick="return false;" tooltip='instructions' data-toggle="popover" data-placement="left" data-trigger="focus" title="Instructions" data-content="#{Step.instructions}")

              tr
                td
                  b Data:
                td(colspan=5)
                  table.table.table-bordered
                    tr
                      td Row
                      td(ng-repeat="fld in headers track by $index")
                        input.form-control(id="{{ currentPage.data[header_row-1][$index+starting_column-1] }}" type='text' ng-model='currentPage.data[header_row-1][$index+starting_column-1]' ng-disabled='validated') 
                    tr(ng-repeat="row in dataBlock track by $index")
                      td(ng-repeat="cell in row track by $index")
                        b {{ cell }}

          hr

          div(ng-show="debug")
            b Headers: {{ headers }}
            br
            b Data: {{ dataBlock }}
            // b Angular Data: {{ data }}
            p &nbsp;
            b Angular Page: {{ page }}
            p &nbsp;
            b Angular Row: {{ row }}